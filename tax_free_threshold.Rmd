---
title: "The Tax Free Threshold"
author: "Dominic Shore"
date: "`r Sys.Date()`"
output: tint::tintPdf
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, include=FALSE}
# load packages used in this note
library("tidyverse") # requires dplyr ver 0.8.0.1
library("readxl")    # requires readxl ver 1.3.1
library("janitor")   # requires janitor ver 1.2.0
library("bannerCommenter") # not required
library("ggrepel")
library("tint")
library("rvest") # To scrape ATO historical TFT rates page


# invalidate cache when the package version changes
knitr::opts_chunk$set(tidy = TRUE, cache.extra = packageVersion('tint'), echo=FALSE, warning=FALSE, message=FALSE)
options(htmltools.dir.version = FALSE, encoding = "UTF-8")

```


```{r Data Munging, include=FALSE}
#-----------------------------------------------------------------------------
#  Local path to Excel file containing 2017 Tax Stats individuals table 2B   -
#      Import annual (2010-11 to 2016-17) file with janitor name repair      -
#             Remove residual footnote numbers in variable names             -
#-----------------------------------------------------------------------------

file_name <- "./ts17individual02lodgmentmethodsextaxablestatusstateageyear.xlsx"

indiv_tax_stats_raw <- read_excel(path = file_name, sheet = "Individuals Table 2B", skip = 2, .name_repair = make_clean_names)

names(indiv_tax_stats_raw) <- names(indiv_tax_stats_raw) %>%
  str_remove_all(pattern = "[0-9]+")

#-----------------------------------------------------------------------------------------------------
#              Calculate _average taxable income_ and _total income or loss_ per cohort              -
#   Add personal income tax payable with (pit_tft) and without (pit_no_tft) the tax free threshold   -
#                           Remove letters preceding age cohort descriptors                          -
#-----------------------------------------------------------------------------------------------------

indiv_tax_stats <- indiv_tax_stats_raw %>%
  mutate(
    #variable created to break the total down to the individual level
    avg_sal_and_wage = salary_or_wages / salary_or_wages_no,

    # Adding variable calculating gross tax liability with the tft
    # pit_tft includes current tft settings
    pit_tft = case_when(
      avg_sal_and_wage <= 18200  ~ 0,
      avg_sal_and_wage <= 37000  ~ ((avg_sal_and_wage - 18201) * 0.1900),
      avg_sal_and_wage <= 90000  ~ ((avg_sal_and_wage - 37001) * 0.3250) + 3572,
      avg_sal_and_wage <= 180000 ~ ((avg_sal_and_wage - 90001) * 0.3700) + 20797,
      TRUE ~ ((avg_sal_and_wage - 180001) * 0.4500) + 54097),

    # Adding an additional factor to show which tax bracket this cohort fall into and factoring properly
    bracket = case_when(
      avg_sal_and_wage <= 18200  ~ "$0 - $18,200",
      avg_sal_and_wage <= 37000  ~ "$18,201 - $37,000",
      avg_sal_and_wage <= 90000  ~ "$37,001 - $90,000",
      avg_sal_and_wage <= 180000 ~ "$90,001 - $180,000",
      TRUE ~ "$180,001 and over"
    ) %>% factor(levels = c("$0 - $18,200", "$18,201 - $37,000", "$37,001 - $90,000", "$90,001 - $180,000", "$180,001 and over"), ordered = TRUE),

    # Adding variable calculating fross tax liability without the tft
    pit_no_tft = case_when(
      avg_sal_and_wage <= 37000 ~ (avg_sal_and_wage * 0.1900),
      avg_sal_and_wage <= 90000 ~ ((avg_sal_and_wage - 37001) * 0.3250) + 7030,
      avg_sal_and_wage <= 180000 ~ ((avg_sal_and_wage - 90001) * 0.3700) + 24255,
      TRUE ~ ((avg_sal_and_wage - 180001) * 0.4500) + 57555),

    # Refactoring the age range variable to play nicely in r
    age_range           = factor(str_remove_all(age_range, pattern = "[a-z][.] "), ordered = TRUE) %>% fct_shift(n = -1L),
    pit_tft_diff        = pit_no_tft - pit_tft,

    #These variables build up the individual level calculations to a total level using the number of taxpayers in each cohort
    total_pit_tft       = pit_tft * salary_or_wages_no,
    total_pit_no_tft    = pit_no_tft * salary_or_wages_no,
    total_pit_tft_diff  = pit_tft_diff * salary_or_wages_no
  ) %>%
  select(1, 3:6, avg_sal_and_wage, bracket, number_of_individuals_no, pit_tft, pit_no_tft, pit_tft_diff, salary_or_wages, salary_or_wages_no, total_pit_tft, total_pit_no_tft, total_pit_tft_diff)

###########################################################################
###########################################################################
###                                                                     ###
###                THE TAX FREE THRESHOLD: PROGRESSIVITY                ###
###                                                                     ###
###########################################################################
###########################################################################


##--------------------------------------------------------------
##  How does the presence of the TFT affect Average Tax Rates?
##--------------------------------------------------------------
indiv_tax_stats %>%
  group_by(bracket) %>%
  summarise(
    avg_tax_paid_with_tft = mean(pit_tft, na.rm = T),
    avg_tax_paid_without_tft = mean(pit_no_tft, na.rm = T)
  )

avg_rates_data <- tibble(
  income = seq(from = 1, to = 200000, by = 100),
  pit_with_tft = case_when(
    income <= 18200  ~ 0,
    income <= 37000  ~ ((income - 18201) * 0.1900),
    income <= 90000  ~ ((income - 37001) * 0.3250) + 3572,
    income <= 180000 ~ ((income - 90001) * 0.3700) + 20797,
    TRUE ~ ((income - 180001) * 0.4500) + 54097),
  pit_without_tft = case_when(
    income <= 37000 ~ (income * 0.1900),
    income <= 90000 ~ ((income - 37001) * 0.3250) + 7030,
    income <= 180000 ~ ((income - 90001) * 0.3700) + 24255,
    TRUE ~ ((income - 180001) * 0.4500) + 57555),
  ATR_with_tft    = pit_with_tft / income,
  ATR_without_tft = pit_without_tft / income
)

##################################################################
##  Scraping data on historical TFT rates from the ATO website  ##
##################################################################
tft_history_ato_web_scrape <- tibble(
  years = read_html('https://www.ato.gov.au/Rates/Individual-income-tax-for-prior-years/') %>% 
    html_nodes(xpath = '//*[(@id = "content-main-wrap")]//h3') %>% 
    html_text(), 
  "Income Threshold" = read_html('https://www.ato.gov.au/Rates/Individual-income-tax-for-prior-years/') %>% 
  html_nodes(xpath = '//tr[(((count(preceding-sibling::*) + 1) = 2) and parent::*)]//td[(((count(preceding-sibling::*) + 1) = 1) and parent::*)]//p') %>% 
  html_text() %>% 
    str_extract_all(pattern = "(?<=\\$)\\d\\d?,\\d{3}") %>% 
    str_remove_all(",") %>% 
    as.numeric()
) %>% 
  mutate(
    "Real Threshold" = `Income Threshold` * 1.03^(as.numeric(rownames(.)) - 1),
    years             = recode(years, "1999â€“2000" = "1999-00")
  ) %>% 
  gather(key = measure, value = "TFT Threshold", -years)

```


# Some background on the policy rationle of the TFT...
`r newthought("The Tax Free Threshold")`  (TFT) is a band of income to which no individual income tax is applied. The TFT serves a dual purpose in the tax system of reducing the compliance burden while enhancing progressivity. The reduction in **compliance burden** manifests itself across two domains: firstly, by excluding low-income (<\$18,300) taxpayers from the system fewer people need to determine how the tax law applies to their circumstances and file a return with the ATO; and secondly, the significant administrative costs involved with handling low-Revenue interactions with taxpayers are  eliminated. While the reduction of compliance burden attributable to the TFT is an interesting subject, the production of accurate estimates is a challenging task that I have left outside the scope of this note given the need for data on taxpayers who do not file returns.

A progressive tax system is defined as one where the average rate of tax increases as income increases and, as we will discover, the contribution of the TFT to **progressivity** is significant. The questions that I have attempted to deal with below has been to do with the distribution of the TFT benefits and the cost involved in removing it while providing compensation to various categories of low-income earners.

# ... and some History
The TFT has been an enduring feature of the tax system
```{r fig-main, fig.cap = "TFT thresholds over time", cache=TRUE}
ggplot(data = tft_history_ato_web_scrape, aes(x = years, y = `TFT Threshold`, colour = measure)) + 
  geom_point() + 
  geom_text(aes(x = 5, y = 14000), label = "TFT\n(real terms)", size = 2.2, colour = "#440154FF") +
  geom_text(aes(x = 4, y = 7000), label = "TFT\n(nominal terms)", size = 2.2, colour = "#21908CFF") +
  scale_y_continuous(labels = scales::dollar) +
  theme_light() + 
  labs(
    y = "",
    x = ""
  ) + 
  theme(
    panel.grid = element_blank(),
    axis.text.x = element_text(angle = 90, vjust = 0.4, size = 6),
    axis.text.y = element_text(size = 6),
    legend.position = "none"
  ) + 
  scale_colour_manual(values=c("#21908CFF", "#440154FF"))
```
The current TFT was set^[Clean Energy (Income Tax Rates Amendments) Bill 2011] in the roll out of the Gillard Government's Carbon Polultion Reduction Scheme. The increase in the TFT and marginal rate schdule were part of a package of measures designed to ensure that the average low and middle-income earners were not financially disadvantaged by the introduction of the carbon pricing mechanism. The changes to the tax system were informed by the Australia's Future Tax System report

1. eliminate the necessity for some interactions with the tax system where tax payer incomes are very low;  and
1. provide

I was interested to explore the varous facets of the TFT as concretely as I could so the ... seemed an obvious place to start. While there remains a question about the extent to which the data has been modified to comply with the taxpayer secrecy provisions (primarily to be found in Div 355 _Taxation Administration Act_ 1953) what follows will hopefully provide some useful estimates of:
1. the distribution of the benefit

# The reduction in compliance burden is large and likely understated by Tax Stats data
`r newthought("Many low-income taxpayers are carved out")` of the requirement to file their tax returns by virtue of the TFT. This is a key benefit of the TFT given the associated compliance cost savings for taxpayers and the administrative savings for the Government. The [most recent release](https://www.ato.gov.au/About-ATO/Research-and-statistics/In-detail/Taxation-statistics/Taxation-statistics-2016-17/) of Taxation Statistics by the Australian Taxation Office (ATO) reveals that roughly 3.4 million taxpayers reported gross income below the TFT (Figure 1). Consider the number of young people working part-time jobs who do not need to engage with the tax system because of the TFT. Similarly affected are [tax-exempt government transfer](https://www.ato.gov.au/individuals/people-with-disability/tax-free-government-pensions-and-payments/) recipients whose only other income is interest income from a bank savings account with a relatively modest balance.
```{r taxpayer_by_bracket, fig.margin = TRUE, fig.cap = "Taxpayers by bracket in 2016-17", fig.width=3.5, fig.height=3.5, cache=TRUE}
indiv_tax_stats %>%
  filter(income_year == "2016â€“17") %>%
  group_by(bracket) %>%
  tally(number_of_individuals_no, name = "tax_payers") %>%
  ggplot(aes(x = bracket, y = tax_payers, fill = bracket)) +
  geom_col() +
  geom_text(
    aes(label = format(tax_payers, big.mark = ","), colour = bracket, y = tax_payers + 10000),
    vjust = -0.5,
    size = 3
  ) +
  scale_y_continuous(scales::comma, expand = expand_scale(mult = c(0, 0.1))) +
  labs(
    x = "",
    y = "",
    title = "",
    caption = "Source: Tax Stats (2017) - Individuals table 2B"
  ) +
  theme_light() +
  theme(
    legend.position = 'none',
    panel.grid =  element_blank(),
    panel.grid.major.x = element_blank(),
    axis.title.y=element_blank(),
    axis.text.y=element_blank(),
    axis.ticks.y=element_blank(),
    axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.6),
    panel.border = element_blank(),
    axis.line.x = element_line(colour = "grey80")
  )

```
When thinking about the number of taxpayers earning below the TFT it is worth bearing in mind that a substantial proportion of these taxpayers will likely have filed in order to claim an overpayment of PAYG withholding tax. Absent from these numbers are taxpayers whose gross incomes were below the TFT and chose not to engage with the system, perhaps because they believed that the PAYG installments were correct to an acceptable margin of error or they did not want to deal with the complexity of filing. In short, the number of people affected by this aspect of the policy is likely to be understated by the Tax Stats data.



`r newthought("The presence")` of the TFT affects Average Tax Rates (ATR) by reducing them at all income levels (Figure 2). The impact is greatest  The impact on an individual earning an [average salary of \$86,974.29](https://www.abs.gov.au/AUSSTATS/abs@.nsf/Latestproducts/6302.0Main%20Features3Nov%202018?opendocument&tabname=Summary&prodno=6302.0&issue=Nov%202018&num=&view=) is another \$3,458 in tax, representing an increase in total tax paid of 17.5 per cent.  Figure 1 shows the impact of the addition of the maximum \$3,458.00 (\$18,200 x 19%) to the [tax] of a person earning \$18,201 dollars per annum obviously has a greater impact than that of the man earning \$180,000. However, the effect is obviously more  pronounced for those on lower incomes.

```{r fig-one, fig.margin=TRUE, fig.width=4, fig.height=4, cache=TRUE, echo=FALSE, fig.cap = "Average tax rates"}
 avg_rates_data %>%
   select(
     income,
     ATR_with_tft,
     ATR_without_tft
   ) %>%
   gather(key = ATR, value = value, - income) %>%
   mutate(ATR_label = case_when(income == 100001 & ATR == "ATR_with_tft" ~ "with TFT",
                                income == 125001 & ATR == "ATR_without_tft" ~ "without TFT",
                                TRUE ~ NA_character_)
   ) %>%
   ggplot(aes(x = income, y = value, colour = ATR)) +
   geom_hline(yintercept = 0, colour = "black") +
   geom_line(size = 1.5) +
   scale_y_continuous(labels = scales::percent_format(accuracy = 1), expand = expand_scale(c(0, 0.1))) +
   scale_x_continuous(labels = scales::dollar, expand = expand_scale(c(0, 0))) +
   theme_light() +
   labs(
     x = "",
     y = "",
     title = "",
     caption = "Source: Tax Framework Division"
   ) +
   theme(
     legend.position = 'none'
   ) +
   geom_text(aes(x = 120000, y = 0.325), label = "Without TFT", size = 3, colour = "#440154FF") +
   geom_text(aes(x = 150000, y = 0.25), label = "With TFT", size = 3, colour = "#21908CFF") +
   scale_colour_manual(values=c("#21908CFF", "#440154FF"))
 ```


```{r echo=FALSE, message=FALSE, warning=FALSE}
 knitr::kable(x =
   indiv_tax_stats %>%
     group_by(bracket) %>%
     summarise(
       avg_tax_paid_with_tft = mean(pit_tft, na.rm = T),
       avg_tax_paid_without_tft = mean(pit_no_tft, na.rm = T)
     ),
     digits = 0,
     format.args = c(big.mark = ","),
     col.names = c("Tax Bracket", "with TFT", "without TFT"),
     caption = "Average tax payments by tax backet"
   )
```
# The costs and benefits
(Need a note here: While there remains a question about the extent to which the data has been modified to comply with the taxpayer secrecy provisions (primarily to be found in Div 355 _Taxation Administration Act_ 1953) what follows will hopefully provide some useful estimates).
```{r, fig.width=10, fig.height = 5, fig.fullwidth = TRUE, warning=FALSE, cache=TRUE}
##################################################################
##          How much income would need to be returned?          ##
##################################################################
indiv_tax_stats %>%
  group_by(income_year, bracket) %>%
  summarise(
    "Total Additional Tax" = sum(total_pit_tft_diff/1000000000, na.rm = TRUE)
  ) %>%
  ggplot(aes(x = bracket, y = `Total Additional Tax`, fill = bracket)) +
  geom_col() +
  geom_text(
    aes(label  = format(round(`Total Additional Tax`, 1), big.mark = ","), 
        colour = bracket, fontface = "bold", y = `Total Additional Tax`),
        vjust  = 0.25,
        hjust  = -0.3,
        size   = 3,
        angle  = 90
  ) +
  facet_grid(cols = vars(income_year)) +
  scale_y_continuous(
    labels = scales::dollar,
    expand = expand_scale(mult = c(0, 0.2)),
    breaks = c(10, 15, 20, 25)
  ) +
  labs(
    x = "",
    y = "Additional Revenue ($bn)",
    title = "Removing the Tax Free Threshold",
    subtitle = "Additional revenue ($bn) collected by tax bracket over period 2010â€“11 to 2016â€“17",
    caption = "Source: Tax Stats (2017) - Individuals table 2B"
  ) +
  theme_light() +
  theme(
    legend.position = 'none',
    axis.text.x = element_text(angle = 90, vjust = 0.4, hjust = 1, size = 8),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    axis.ticks = element_blank(),
    axis.text.y = element_blank(),
    axis.title.y = element_text(size = 8),
    plot.title = element_text(size = 12),
    plot.subtitle = element_text(size = 10),
    strip.text = element_text(size = 8)
  )
```